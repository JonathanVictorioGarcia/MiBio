{% extends "base.html" %}
{% block title %}Preguntas Frecuentes - Mibio{% endblock %}

{% block body %}
<div class="min-h-dvh grid md:grid-cols-[260px_1fr]">
  <!-- SIDEBAR -->
  <aside class="bg-slate-900/70 border-r border-slate-800 p-4 md:sticky md:top-0 md:h-dvh overflow-auto no-scrollbar">
    {% include "dashboard/_sidebar_user.html" %}
  </aside>

  <!-- MAIN -->
  <main class="bg-gradient-to-b from-slate-900 to-slate-950 text-slate-100">
    <div class="max-w-6xl mx-auto px-4 py-6 md:py-10">

      <!-- Header -->
      <div class="flex items-start md:items-center justify-between gap-4">
        <div>
          <h1 class="text-2xl md:text-3xl font-extrabold tracking-tight">Preguntas frecuentes</h1>
          <p class="text-slate-400 mt-1">Encuentra respuestas r√°pidas sobre cuenta, tarjetas, dise√±o, estad√≠sticas y m√°s.</p>
        </div>
        <a href="{% url 'dashboard:user_support' %}" class="rounded-xl bg-indigo-600 hover:bg-indigo-500 px-4 py-2 font-semibold">
          üìù Abrir ticket
        </a>
      </div>

      <!-- Search + Chips -->
      <section class="mt-6">
        <div class="grid md:grid-cols-[1fr_320px] gap-4">
          <div class="rounded-2xl border border-slate-800 bg-slate-900/60 p-4">
            <label for="faqSearch" class="text-sm text-slate-400">Buscar en FAQs</label>
            <div class="mt-2 flex items-center gap-2">
              <input id="faqSearch" type="search" placeholder="Escribe una palabra clave (ej. QR, GA4, dominio)‚Ä¶"
                     class="w-full rounded-xl bg-slate-800 border border-slate-700/60 px-3 py-2 outline-none focus:ring-2 focus:ring-indigo-600/40" />
              <button type="button" class="rounded-xl bg-slate-800 border border-slate-700/70 px-3 py-2">Buscar</button>
            </div>
            {% if quick_suggestions %}
            <div class="mt-3 flex flex-wrap gap-2 text-xs">
              {% for s in quick_suggestions %}
              <button type="button" class="px-2.5 py-1 rounded-lg bg-slate-800 border border-slate-700/70 hover:bg-slate-700"
                      data-chip="{{ s|lower }}">{{ s }}</button>
              {% endfor %}
            </div>
            {% endif %}
          </div>

          <!-- Categor√≠as -->
          <div class="rounded-2xl border border-slate-800 bg-slate-900/60 p-4">
            <div class="text-sm text-slate-400 mb-2">Filtrar por categor√≠a</div>
            <div class="grid grid-cols-2 gap-2">
              <button class="cat-btn px-3 py-2 rounded-xl bg-slate-800 border border-slate-700/70 hover:bg-slate-700"
                      data-category="">Todas</button>
              {% for c in categories %}
              <button class="cat-btn px-3 py-2 rounded-xl bg-slate-800 border border-slate-700/70 hover:bg-slate-700"
                      data-category="{{ c }}">{{ c }}</button>
              {% endfor %}
            </div>
          </div>
        </div>
      </section>

      <!-- FAQ List -->
      <section class="mt-6">
        <div id="faqList" class="space-y-3">
          {% for item in faqs %}
          <div class="faq-item rounded-2xl border border-slate-800 bg-slate-900/60 overflow-hidden"
               data-category="{{ item.category }}"
               data-text="{{ item.q|lower }} {{ item.a|lower }}">
            <button class="w-full text-left px-5 py-4 flex items-center justify-between faq-head">
              <div>
                <div class="text-[11px] text-slate-400">{{ item.category }}</div>
                <div class="font-semibold leading-tight mt-0.5">{{ item.q }}</div>
              </div>
              <span class="text-slate-400">+</span>
            </button>
            <div class="px-5 pb-5 hidden faq-body">
              <p class="text-slate-300 text-sm leading-relaxed">{{ item.a }}</p>
            </div>
          </div>
          {% endfor %}
        </div>

        <!-- Empty state -->
        <div id="faqEmpty" class="hidden mt-10 text-center text-slate-400">
          <div class="mx-auto size-16 rounded-2xl bg-slate-800 grid place-items-center">ü§î</div>
          <p class="mt-4">No encontramos resultados con tu b√∫squeda o filtros.</p>
          <div class="mt-3">
            <a href="{% url 'dashboard:user_support' %}" class="inline-block rounded-xl bg-indigo-600 hover:bg-indigo-500 px-4 py-2 font-semibold">Cont√°ctanos</a>
          </div>
        </div>
      </section>

      <!-- CTA final -->
      <section class="mt-10">
        <div class="rounded-2xl border border-slate-800 bg-gradient-to-r from-indigo-600/20 to-fuchsia-600/20 p-5 flex flex-col md:flex-row md:items-center md:justify-between gap-3">
          <div>
            <h4 class="font-semibold">¬øTienes otra duda?</h4>
            <p class="text-sm text-slate-300">Nuestro equipo responde normalmente en 2‚Äì4 h h√°biles.</p>
          </div>
          <a href="{% url 'dashboard:user_support' %}" class="px-4 py-2 rounded-xl bg-indigo-600 hover:bg-indigo-500 font-medium w-fit">Ir a Soporte</a>
        </div>
      </section>

    </div>
  </main>
</div>

<script>
  // Acorde√≥n
  document.addEventListener('click', (e)=>{
    const head = e.target.closest('.faq-head');
    if(!head) return;
    const body = head.parentElement.querySelector('.faq-body');
    const icon = head.querySelector('span:last-child');
    const open = body.classList.contains('hidden');
    document.querySelectorAll('.faq-body').forEach(b=>b.classList.add('hidden'));
    document.querySelectorAll('.faq-head span:last-child').forEach(i=>i.textContent = '+');
    if(open){ body.classList.remove('hidden'); icon.textContent = '‚àí'; }
  });

  // Filtros
  const list = document.getElementById('faqList');
  const empty = document.getElementById('faqEmpty');
  const search = document.getElementById('faqSearch');
  const catBtns = document.querySelectorAll('.cat-btn');

  let activeCategory = '';
  function applyFilters(){
    const q = (search.value || '').trim().toLowerCase();
    let visible = 0;
    list.querySelectorAll('.faq-item').forEach(card=>{
      const cat = card.dataset.category || '';
      const txt = card.dataset.text || '';
      const matchCat = !activeCategory || cat === activeCategory;
      const matchTxt = !q || txt.includes(q);
      const show = matchCat && matchTxt;
      card.style.display = show ? '' : 'none';
      if(show) visible++;
    });
    empty.classList.toggle('hidden', visible > 0);
  }
  search.addEventListener('input', applyFilters);
  catBtns.forEach(btn=>{
    btn.addEventListener('click', ()=>{
      activeCategory = btn.dataset.category || '';
      catBtns.forEach(b=> b.classList.remove('ring-2','ring-indigo-500/50'));
      btn.classList.add('ring-2','ring-indigo-500/50');
      applyFilters();
    });
  });

  // Chips (quick suggestions) insertan texto en el buscador
  document.querySelectorAll('[data-chip]').forEach(ch=>{
    ch.addEventListener('click', ()=>{ search.value = ch.dataset.chip; applyFilters(); });
  });
</script>
{% endblock %}
