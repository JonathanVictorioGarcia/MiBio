{% extends "base.html" %}
{% block title %}Editar Datos - Mibio{% endblock %}

{% block body %}
<div class="grid min-h-dvh md:grid-cols-[260px_1fr]">
  <!-- SIDEBAR (igual que el dashboard) -->
  <aside class="bg-slate-900/70 border-r border-slate-800 p-4 md:sticky md:top-0 md:h-dvh overflow-auto no-scrollbar">
    {# si lo moviste a partials usa: "dashboard/partials/_sidebar_user.html" #}
    {% include "dashboard/_sidebar_user.html" %}
  </aside>

  <!-- MAIN -->
  <main class="p-5 md:p-8 space-y-6">
    <div>
      <h2 class="text-xl md:text-2xl font-semibold">Editar datos</h2>
      <p class="text-sm text-slate-400">Actualiza tu información personal y de acceso.</p>
    </div>

    <!-- Mensajes -->
    {% if messages %}
      <div class="space-y-2">
        {% for message in messages %}
          <div class="rounded-xl border p-3 text-sm
            {% if message.tags == 'success' %} border-emerald-800/50 bg-emerald-900/30 text-emerald-100
            {% elif message.tags == 'error' %} border-rose-800/50 bg-rose-900/30 text-rose-100
            {% else %} border-slate-800 bg-slate-900/50 text-slate-200 {% endif %}">
            {{ message }}
          </div>
        {% endfor %}
      </div>
    {% endif %}

    <!-- Card del formulario -->
    <section class="rounded-2xl border border-slate-800 bg-slate-900/50 p-5">
      <form method="post" class="space-y-5">
        {% csrf_token %}
        <div class="grid md:grid-cols-2 gap-4">
          <!-- Nombre -->
          <div>
            <label for="id_first_name" class="block text-sm text-slate-300 mb-1">Nombre</label>
            <input id="id_first_name" name="first_name" type="text"
                   value="{{ form.first_name.value|default_if_none:'' }}"
                   class="w-full px-3 py-2 rounded-lg bg-slate-900 border border-slate-800 outline-none" />
            {% if form.first_name.errors %}
              <p class="mt-1 text-xs text-rose-300">{{ form.first_name.errors|join:", " }}</p>
            {% endif %}
          </div>

          <!-- Apellidos -->
          <div>
            <label for="id_last_name" class="block text-sm text-slate-300 mb-1">Apellidos</label>
            <input id="id_last_name" name="last_name" type="text"
                   value="{{ form.last_name.value|default_if_none:'' }}"
                   class="w-full px-3 py-2 rounded-lg bg-slate-900 border border-slate-800 outline-none" />
            {% if form.last_name.errors %}
              <p class="mt-1 text-xs text-rose-300">{{ form.last_name.errors|join:", " }}</p>
            {% endif %}
          </div>

          <!-- Correo -->
          <div>
            <label for="id_email" class="block text-sm text-slate-300 mb-1">Correo</label>
            <input id="id_email" name="email" type="email"
                   value="{{ form.email.value|default_if_none:'' }}"
                   class="w-full px-3 py-2 rounded-lg bg-slate-900 border border-slate-800 outline-none" />
            {% if form.email.errors %}
              <p class="mt-1 text-xs text-rose-300">{{ form.email.errors|join:", " }}</p>
            {% endif %}
          </div>

          <!-- Usuario -->
          <div>
            <label for="id_username" class="block text-sm text-slate-300 mb-1">Usuario</label>
            <input id="id_username" name="username" type="text"
                   value="{{ form.username.value|default_if_none:'' }}"
                   class="w-full px-3 py-2 rounded-lg bg-slate-900 border border-slate-800 outline-none" />
            {% if form.username.errors %}
              <p class="mt-1 text-xs text-rose-300">{{ form.username.errors|join:", " }}</p>
            {% endif %}
          </div>
        </div>

        <div class="flex flex-col md:flex-row gap-3 md:items-center md:justify-between">
          <p class="text-xs text-slate-400">
            ¿Deseas cambiar tu contraseña? (lo habilitaremos en breve)
          </p>
          <div class="flex gap-2">
            <a href="{% url 'dashboard:user_dashboard' %}" class="px-4 py-2 rounded-xl border border-slate-800 hover:bg-slate-900">Cancelar</a>
            <button type="submit" class="px-4 py-2 rounded-xl bg-indigo-600 hover:bg-indigo-500 font-medium">
              Guardar cambios
            </button>
          </div>
        </div>
      </form>
    </section>

    <!-- Sección extra: datos de cuenta -->
    <section class="rounded-2xl border border-slate-800 bg-slate-900/40 p-5">
      <h3 class="font-medium mb-2">Información de la cuenta</h3>
      <ul class="text-sm text-slate-300 space-y-1">
        <li><span class="text-slate-400">Creación:</span> {{ request.user.date_joined|date:"d/m/Y H:i" }}</li>
        <li><span class="text-slate-400">Último acceso:</span> {{ request.user.last_login|date:"d/m/Y H:i" }}</li>
        <li><span class="text-slate-400">Rol:</span> {{ request.user.role }}</li>
      </ul>
    </section>
  </main>
</div>
{% endblock %}
